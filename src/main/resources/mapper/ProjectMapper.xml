<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.tju.doctor.dao.ProjectMapper">

    <select id="getProjectByTimeAndState" resultType="cn.tju.doctor.daomain.ProjectBean" parameterType="cn.tju.doctor.daomain.ProjectState">
        SELECT * FROM projects WHERE beginTime <![CDATA[<=]]> #{stateValue1} AND ${state2} = #{stateValue2};
    </select>


    <select id="getProjectByIDAndState" resultType="cn.tju.doctor.daomain.ProjectBean" parameterType="cn.tju.doctor.daomain.ProjectState">
        SELECT * FROM projects WHERE ${state1} = #{stateValue1} AND ${state2} = #{stateValue2};
    </select>

    <select id="getProjectByProjectID" resultType="cn.tju.doctor.daomain.ProjectBean" parameterType="String">
        SELECT * FROM projects WHERE projectID = #{projectID}  ORDER BY process DESC;
    </select>

    <select id="getProjectByUserProjectID" resultType="cn.tju.doctor.daomain.ProjectBean" parameterType="String">
        SELECT * FROM projects WHERE projectID = #{projectID} AND (acceptuser = #{userID} OR createuser = #{userID});
    </select>

<!--    <select id="getWorkByEmail" resultType="cn.tju.doctor.daomain.Work" parameterType="String">-->
<!--        SELECT * FROM works WHERE token = #{token} ;-->
<!--    </select>-->


    <insert id="insertProject" parameterType="cn.tju.doctor.daomain.ProjectBeanAdd">
        INSERT INTO projects (uuid, projectID, beginTime, process, name, data, dataURL, introduce, createuser, projectaccount, projectmoney, company, actor)
        VALUES  (#{uuid}, #{projectID}, #{beginTime}, #{process}, #{name}, #{data}, #{dataURL}, #{introduce}, #{createuser}, #{projectaccount}, #{projectmoney}, #{company}, #{actor})
    </insert>

    <insert id="modifyProject" parameterType="cn.tju.doctor.daomain.ProjectBeanAdd">
        INSERT INTO projects (uuid, projectID, name, acceptuser, userdataURL, userType, company, actor)
        VALUES  (#{uuid}, #{projectID}, #{name}, #{acceptuser}, #{userdataURL}, #{userType}, #{company}, #{actor})
    </insert>

<!--    <delete id="deleteWorkById" parameterType="java.lang.Integer">-->
<!--        DELETE FROM users WHERE id = #{id}-->
<!--    </delete>-->

    <update id="updateWork" parameterType="cn.tju.doctor.daomain.WorkState">
        UPDATE works
        <set>
            <if test='workState.type == "0"'>ifRead="1",</if>
            <if test='workState.type == "1"'>ifFinish="1",</if>
            <if test="workState.workfile != null">workfile=#{workState.workfile}</if>
        </set>
        WHERE uuid=#{workState.uuid}
    </update>


    <update id="updateProject" parameterType="cn.tju.doctor.daomain.ProjectState">
        UPDATE projects SET ifWork="1", endtime=NOW() WHERE ${state1} = #{stateValue1} AND ${state2} = #{stateValue2};
    </update>
</mapper>